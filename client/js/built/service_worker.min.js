"use strict";const e="0.9.10",t=e,n="/",o="/offline",r=[o,"/app","/favicon.png","/css","/doc.css","/about","/help","/open_source","/offline","/quit","/z-worker.js","/inflate.js","/http","/express","/body-parser","/socket.io"],c=4,s=1e4,i=location.origin,u={},a={},f={},h={};let l=[];const d=function(e){clearTimeout(h[e]),a[e](u[e]),delete u[e],delete a[e],delete f[e]},p=function(e,t){f[e]&&(f[e](t),delete a[e],delete f[e])},m=function(e){const t=e.header.ressource,n=new Promise(function(e,n){a[t]=e,f[t]=n,u.hasOwnProperty(t)&&d(t),h[t]=setTimeout(function(){p(t,"No answer after 10 seconds")},s)});return self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(e)})}),n},g=function(){return console.log("logInTheUI function exists"),function(e){self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage({LOG:e})})})}}(),w=function(e){l.push(e)},y=function(e,t={}){return fetch(e,t).then(function(e){return e&&e.ok?e:Promise.reject("fetch failed")})},E=function(e){return caches.open(t).then(function(t){return t.match(e).then(function(e){return e&&e.ok?e:Promise.reject("Not in Cache")})})},P=function(e){return!String(e).match("rtc")},b=function(){return caches.open(t).then(function(e){return Promise.all(r.map(function(t){return e.add(t).catch(function(e){return w([t+"failed: "+String(e)])})}))})},v=function(){return caches.keys().then(function(e){return Promise.all(e.map(function(e){if(t!==e)return caches.delete(e)}))})},x=function(){return E(new Request(o))};self.addEventListener("install",function(e){e.waitUntil(b().then(skipWaiting))}),self.addEventListener("activate",function(e){e.waitUntil(v().then(function(){return self.clients.claim()}))}),self.addEventListener("message",function(e){const t=e.data,n=t.ressource,o=t.answer;u[n]=o,a.hasOwnProperty(n)&&d(n)}),self.addEventListener("fetch",function(e){const t=e.request,o=t.clone(),r=t.url;if(l&&(l.forEach(g),l=void 0),P(r))e.respondWith(E(t).then(function(e){return e}).catch(function(e){return y(o)}).then(function(e){return e}).catch(function(e){return i+n===r?x():Promise.reject(e)}));else{const n=t.method,o=t.headers,s={header:{ressource:r.substring(r.indexOf("rtc/")+c),method:n},body:""};o.forEach(function(e,t){s.header[t]=e}),e.respondWith(t.arrayBuffer().then(function(e){const n=t.bodyUsed;n&&e&&(s.body=e)}).catch(function(e){}).then(function(e){return m(s)}).then(function(e){const t=new Response(e.body,{headers:e.header,status:e.header.status||200,statusText:e.header.statusText||"OK"});return t}).catch(function(e){const t=new Response(`<html><p>${e}</p></html>`,{headers:{"Content-type":"text/html"},status:500,statusText:"timedout"});return t}))}});