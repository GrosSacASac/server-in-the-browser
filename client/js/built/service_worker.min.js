"use strict";const e="0.9.26",t=e,n="/offline",r=[n,"/app","/favicon.png","/css","/doc.css","/about","/help","/open_source","/offline","/quit","/z-worker.js","/inflate.js","/http","/express","/body-parser","/socket.io"],c=1e4,o=location.origin,s={},u={},i={},f={};let a=[];const h=function(e){clearTimeout(f[e]),u[e](s[e]),delete s[e],delete u[e],delete i[e]},d=function(e,t){i[e]&&(i[e](t),delete u[e],delete i[e])},l=function(e){const t=e.header.ressource,n=new Promise(function(e,n){u[t]=e,i[t]=n,s.hasOwnProperty(t)&&h(t),f[t]=setTimeout(function(){d(t,"No answer after 10 seconds")},c)});return self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(e)})}),n},p=function(){return function(e){self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage({LOG:e})})})}}(),m=function(e){a.push(e)},w=function(e,t={}){return fetch(e,t).then(function(e){return e&&e.ok?e:Promise.reject("fetch failed")})},y=function(e){return caches.open(t).then(function(t){return t.match(e).then(function(e){return e&&e.ok?e:Promise.reject("Not in Cache")})})},g=function(e){return!String(e).match("rtc")},P=function(){return caches.open(t).then(function(e){return Promise.all(r.map(function(t){return e.add(t).catch(function(e){return m([t+"failed: "+String(e)])})}))})},E=function(e,n){return caches.open(t).then(function(t){return t.put(e,n.clone()),n})},b=function(){return caches.keys().then(function(e){return Promise.all(e.map(function(e){if("0.9.26"!==e)return caches.delete(e)}))})},v=function(){return y(new Request(n))},k=function(e){return o+"/"===e};self.addEventListener("install",function(e){e.waitUntil(P().then(skipWaiting))}),self.addEventListener("activate",function(e){e.waitUntil(b().then(function(){return self.clients.claim()}))}),self.addEventListener("message",function(e){const t=e.data,n=t.ressource,r=t.answer;s[n]=r,u.hasOwnProperty(n)&&h(n)}),self.addEventListener("fetch",function(e){const t=e.request,n=t.url;if(a&&(a.forEach(p),a=void 0),g(n)){if("POST"===t.method)return;e.respondWith(y(t).then(function(e){return e}).catch(function(e){return w(t)}).then(function(e){return k(n)?e:E(t,e).catch(function(t){return e})}).catch(function(e){return k(n)?v():Promise.reject(e)}))}else{const r=t.method,c=t.headers,o={header:{ressource:n.substring(n.indexOf("rtc/")+4),method:r},body:""};c.forEach(function(e,t){o.header[t]=e}),e.respondWith(t.arrayBuffer().then(function(e){const n=t.bodyUsed;n&&e&&(o.body=e)}).catch(function(e){}).then(function(e){return l(o)}).then(function(e){const t=new Response(e.body,{headers:e.header,status:e.header.status||200,statusText:e.header.statusText||"OK"});return t}).catch(function(e){const t=new Response(`<html><p>${e}</p></html>`,{headers:{"Content-type":"text/html"},status:500,statusText:"timedout"});return t}))}});