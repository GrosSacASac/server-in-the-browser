"use strict";const e="2.0.21",t=e,n="/",s="/offline",r=[s],o=4,c=1e4,i=location.origin,u={},a={},f={},h={},d=function(e){clearTimeout(h[e]),a[e](u[e]),delete u[e],delete a[e],delete f[e]},l=function(e,t){f[e]&&(f[e](t),delete a[e],delete f[e])},m=function(e){const t=e.header.ressource,n=new Promise(function(e,n){a[t]=e,f[t]=n,u.hasOwnProperty(t)&&d(t),h[t]=setTimeout(function(){l(t,"No answer after 10 seconds")},c)});return self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(e)})}),n},w=function(e){return!String(e).match("rtc")};self.addEventListener("install",function(e){e.waitUntil(caches.open(t).then(function(e){return e.addAll(r)}).then(function(){return self.skipWaiting()}))}),self.addEventListener("activate",function(e){e.waitUntil(caches.keys().then(function(e){return Promise.all(e.map(function(e){if(t!==e)return caches.delete(e)}))}))}),self.addEventListener("message",function(e){const t=e.data,n=t.ressource,s=t.answer;u[n]=s,a.hasOwnProperty(n)&&d(n)}),self.addEventListener("fetch",function(e){const t=e.request,r=t.url;if(w(r))return void e.respondWith(caches.match(t).then(function(e){return console.log(t,r),e?e:fetch(t).then(function(e){if(e)return e}).catch(function(e){if(i+n===r)return caches.match(new Request(s));throw new Error(e)})}));const c=t.method,u=t.headers,a={header:{ressource:r.substring(r.indexOf("rtc/")+o),method:c},body:""};u.forEach(function(e,t){a.header[t]=e}),e.respondWith(t.arrayBuffer().then(function(e){const n=t.bodyUsed;n&&e&&(a.body=e)}).catch(function(e){}).then(function(e){return m(a)}).then(function(e){const t=new Response(e.body,{headers:e.header,status:e.header.status||200,statusText:e.header.statusText||"OK"});return t}).catch(function(e){const t=new Response(`<html><p>${e}</p></html>`,{headers:{"Content-type":"text/html"},status:500,statusText:"timedout"});return t}))});