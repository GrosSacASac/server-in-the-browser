"use strict";const t="0.20.28",e=t,n="/offline",r=[],c=1e4,o=location.origin,u={},i={},s={},f={};let a=[];const h=function(t){clearTimeout(f[t]),i[t](u[t]),delete u[t],delete i[t],delete s[t]},d=function(t,e){s[t]&&(s[t](e),delete i[t],delete s[t])},l=function(t){const e=t.header.ressource,n=new Promise(function(t,n){i[e]=t,s[e]=n,u.hasOwnProperty(e)&&h(e),f[e]=setTimeout(function(){d(e,"No answer after 10 seconds")},c)});return self.clients.matchAll().then(function(e){e.forEach(function(e){e.postMessage(t)})}),n},m=function(){return function(t){console.log(t),self.clients.matchAll().then(function(e){e.forEach(function(e){e.postMessage({LOG:JSON.parse(JSON.stringify(t))})})})}}(),p=function(t){a.push(t)},g=function(t,e={}){return fetch(t,e).then(function(t){return t&&t.ok?t:Promise.reject("fetch failed")})},w=function(t){return caches.open(e).then(function(e){return e.match(t).then(function(t){return t&&t.ok?t:Promise.reject("Not in Cache")})})},y=function(t){return!String(t).match("rtc")},P=function(){return caches.open(e).then(function(t){return Promise.all(r.map(function(e){return t.add(e).catch(function(t){return p([e+"failed: "+String(t)])})}))})},E=function(t,n){return caches.open(e).then(function(e){return e.put(t,n.clone()),n})},O=function(){return caches.keys().then(function(t){return Promise.all(t.map(function(t){if("0.20.28"!==t)return caches.delete(t)}))})},v=function(){return w(new Request(n))},T=function(t){return o+"/"===t};self.addEventListener("install",function(t){t.waitUntil(P().then(skipWaiting))}),self.addEventListener("activate",function(t){t.waitUntil(O().then(function(){return self.clients.claim()}))}),self.addEventListener("message",function(t){const e=t.data,n=e.ressource,r=e.answer;u[n]=r,i.hasOwnProperty(n)&&h(n)}),self.addEventListener("fetch",function(t){const e=t.request,n=e.url;if(a&&(a.forEach(m),a=void 0),y(n)){if("POST"===e.method)return;t.respondWith(w(e.clone()).then(function(t){return t}).catch(function(t){return g(e)}).then(function(t){return T(n)?t:E(e,t).catch(function(e){return t})}).catch(function(t){return T(n)?v():Promise.reject(t)}))}else{const r=e.method,c=e.headers,o={header:{ressource:n.substring(n.indexOf("rtc/")+4),method:r},body:""};c.forEach(function(t,e){o.header[e]=t}),t.respondWith(e.arrayBuffer().then(function(t){const n=e.bodyUsed;n&&t&&(o.body=t)}).catch(function(t){}).then(function(t){return l(o)}).then(function(t){const e=new Response(t.body,{headers:t.header,status:t.header.status||200,statusText:t.header.statusText||"OK"});return e}).catch(function(t){const e=new Response(`<html><p>${t}</p></html>`,{headers:{"Content-type":"text/html"},status:500,statusText:"timedout"});return e}))}});