"use strict";const e="2.0.23",t=e,n="/",s="/offline",o=[s,"/favicon.png","/css","/doc.css","/about","/help","/open_source","/offline","/quit","/z-worker.js","/inflate.js","/http","/express","/body-parser","/socket.io"],r=4,c=1e4,i=location.origin,a={},u={},f={},h={},d=function(e){clearTimeout(h[e]),u[e](a[e]),delete a[e],delete u[e],delete f[e]},l=function(e,t){f[e]&&(f[e](t),delete u[e],delete f[e])},p=function(e){const t=e.header.ressource,n=new Promise(function(e,n){u[t]=e,f[t]=n,a.hasOwnProperty(t)&&d(t),h[t]=setTimeout(function(){l(t,"No answer after 10 seconds")},c)});return self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(e)})}),n},m=function(e){return!String(e).match("rtc")};self.addEventListener("install",function(e){e.waitUntil(caches.open(t).then(function(e){return e.addAll(o)}).then(function(){return self.skipWaiting()}))}),self.addEventListener("activate",function(e){e.waitUntil(caches.keys().then(function(e){return Promise.all(e.map(function(e){if(t!==e)return caches.delete(e)}))}))}),self.addEventListener("message",function(e){const t=e.data,n=t.ressource,s=t.answer;a[n]=s,u.hasOwnProperty(n)&&d(n)}),self.addEventListener("fetch",function(e){const t=e.request,o=t.url;if(m(o))return void e.respondWith(caches.match(t).then(function(e){return console.log(t,o),e?e:fetch(t).then(function(e){if(e)return e}).catch(function(e){if(i+n===o)return caches.match(new Request(s));throw new Error(e)})}));const c=t.method,a=t.headers,u={header:{ressource:o.substring(o.indexOf("rtc/")+r),method:c},body:""};a.forEach(function(e,t){u.header[t]=e}),e.respondWith(t.arrayBuffer().then(function(e){const n=t.bodyUsed;n&&e&&(u.body=e)}).catch(function(e){}).then(function(e){return p(u)}).then(function(e){const t=new Response(e.body,{headers:e.header,status:e.header.status||200,statusText:e.header.statusText||"OK"});return t}).catch(function(e){const t=new Response(`<html><p>${e}</p></html>`,{headers:{"Content-type":"text/html"},status:500,statusText:"timedout"});return t}))});