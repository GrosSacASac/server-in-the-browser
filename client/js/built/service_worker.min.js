"use strict";const e="0.9.18",t=e,n="/",r="/offline",c=[r,"/app","/favicon.png","/css","/doc.css","/about","/help","/open_source","/offline","/quit","/z-worker.js","/inflate.js","/http","/express","/body-parser","/socket.io"],o=4,s=1e4,u=location.origin,i={},f={},a={},h={};let d=[];const l=function(e){clearTimeout(h[e]),f[e](i[e]),delete i[e],delete f[e],delete a[e]},p=function(e,t){a[e]&&(a[e](t),delete f[e],delete a[e])},m=function(e){const t=e.header.ressource,n=new Promise(function(e,n){f[t]=e,a[t]=n,i.hasOwnProperty(t)&&l(t),h[t]=setTimeout(function(){p(t,"No answer after 10 seconds")},s)});return self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(e)})}),n},w=function(){return function(e){self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage({LOG:e})})})}}(),y=function(e){d.push(e)},g=function(e,t={}){return fetch(e,t).then(function(e){return e&&e.ok?e:Promise.reject("fetch failed")})},P=function(e){return caches.open(t).then(function(t){return t.match(e).then(function(e){return e&&e.ok?e:Promise.reject("Not in Cache")})})},E=function(e){return!String(e).match("rtc")},b=function(){return caches.open(t).then(function(e){return Promise.all(c.map(function(t){return e.add(t).catch(function(e){return y([t+"failed: "+String(e)])})}))})},v=function(e,n){return caches.open(t).then(function(t){return t.put(e,n.clone()),n})},k=function(){return caches.keys().then(function(e){return Promise.all(e.map(function(e){if(t!==e)return caches.delete(e)}))})},x=function(){return P(new Request(r))},O=function(e){return u+n===e};self.addEventListener("install",function(e){e.waitUntil(b().then(skipWaiting))}),self.addEventListener("activate",function(e){e.waitUntil(k().then(function(){return self.clients.claim()}))}),self.addEventListener("message",function(e){const t=e.data,n=t.ressource,r=t.answer;i[n]=r,f.hasOwnProperty(n)&&l(n)}),self.addEventListener("fetch",function(e){const t=e.request,n=t.url;if(d&&(d.forEach(w),d=void 0),E(n)){if("POST"===t.method)return;e.respondWith(P(t).then(function(e){return e}).catch(function(e){return g(t)}).then(function(e){return O(n)?e:v(t,e).catch(function(t){return e})}).catch(function(e){return O(n)?x():Promise.reject(e)}))}else{const r=t.method,c=t.headers,s={header:{ressource:n.substring(n.indexOf("rtc/")+o),method:r},body:""};c.forEach(function(e,t){s.header[t]=e}),e.respondWith(t.arrayBuffer().then(function(e){const n=t.bodyUsed;n&&e&&(s.body=e)}).catch(function(e){}).then(function(e){return m(s)}).then(function(e){const t=new Response(e.body,{headers:e.header,status:e.header.status||200,statusText:e.header.statusText||"OK"});return t}).catch(function(e){const t=new Response(`<html><p>${e}</p></html>`,{headers:{"Content-type":"text/html"},status:500,statusText:"timedout"});return t}))}});